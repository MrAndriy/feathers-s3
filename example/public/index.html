<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>feathers-s3 axample</title>
  </head>
  <body>
    <main id="main" class="container">
      <h1>Welcome to feathers-s3</h1>
      <form class="form" onsubmit="uploadFile(event.preventDefault())">
        <input type="file" id="file" />
        <button type="submit" class="button button-primary">Upload file</button>
      </form>
    </main>

    <script src="https://unpkg.com/@feathersjs/client@^5.0.0-pre.28/dist/feathers.js"></script>
    <script src="https://unpkg.com/socket.io-client@4.5.3/dist/socket.io.min.js"></script>
    <!--script type="module" src="/feathers-s3/client.js"></script-->
    <script type="module">
      import { getClientService } from '/feathers-s3/client.js'
      // Create the client Feathers app
      const app = feathers()
      // Configure the transport using socket.io
      const socket = io('http://localhost:3333')
      const transport = feathers.socketio(socket)
      app.configure(transport)
      // Configure and get the s3 service
      const s3Service = getClientService(app, { 
        transport, 
        fetch: window.fetch.bind(window),
        useProxy: true
      })
      
      // Form submission handler that sends a new message
      window.uploadFile = async () => {
        try {
          const file = document.getElementById('file').files[0]
          const response = await s3Service.upload(file.name, file)
          console.log(response)
        } catch (error) {
          console.error(error)
        }
      }
    </script>
  </body>
</html>